{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.schema = exports.theme = undefined;\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _class, _temp;\n\nvar _react = require(\"react\");\n\nvar React = _interopRequireWildcard(_react);\n\nvar _slate = require(\"slate\");\n\nvar _slateReact = require(\"slate-react\");\n\nvar _styledComponents = require(\"styled-components\");\n\nvar _styledComponents2 = _interopRequireDefault(_styledComponents);\n\nvar _theme = require(\"./theme\");\n\nvar _schema = require(\"./schema\");\n\nvar _schema2 = _interopRequireDefault(_schema);\n\nvar _getDataTransferFiles = require(\"./lib/getDataTransferFiles\");\n\nvar _getDataTransferFiles2 = _interopRequireDefault(_getDataTransferFiles);\n\nvar _isModKey = require(\"./lib/isModKey\");\n\nvar _isModKey2 = _interopRequireDefault(_isModKey);\n\nvar _Flex = require(\"./components/Flex\");\n\nvar _Flex2 = _interopRequireDefault(_Flex);\n\nvar _serializer = require(\"./serializer\");\n\nvar _serializer2 = _interopRequireDefault(_serializer);\n\nvar _plugins = require(\"./plugins\");\n\nvar _plugins2 = _interopRequireDefault(_plugins);\n\nvar _commands = require(\"./commands\");\n\nvar _commands2 = _interopRequireDefault(_commands);\n\nvar _queries = require(\"./queries\");\n\nvar _queries2 = _interopRequireDefault(_queries);\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n}\n\nfunction _objectWithoutProperties(obj, keys) {\n  var target = {};\n\n  for (var i in obj) {\n    if (keys.indexOf(i) >= 0) continue;\n    if (!Object.prototype.hasOwnProperty.call(obj, i)) continue;\n    target[i] = obj[i];\n  }\n\n  return target;\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var gen = fn.apply(this, arguments);\n    return new Promise(function (resolve, reject) {\n      function step(key, arg) {\n        try {\n          var info = gen[key](arg);\n          var value = info.value;\n        } catch (error) {\n          reject(error);\n          return;\n        }\n\n        if (info.done) {\n          resolve(value);\n        } else {\n          return Promise.resolve(value).then(function (value) {\n            step(\"next\", value);\n          }, function (err) {\n            step(\"throw\", err);\n          });\n        }\n      }\n\n      return step(\"next\");\n    });\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar theme = exports.theme = _theme.light;\nvar schema = exports.schema = _schema2.default;\nvar defaultOptions = {};\nvar RichMarkdownEditor = (_temp = _class = function (_React$PureComponent) {\n  _inherits(RichMarkdownEditor, _React$PureComponent);\n\n  function RichMarkdownEditor(props) {\n    var _this2 = this;\n\n    _classCallCheck(this, RichMarkdownEditor);\n\n    var _this = _possibleConstructorReturn(this, (RichMarkdownEditor.__proto__ || Object.getPrototypeOf(RichMarkdownEditor)).call(this, props));\n\n    _this.prevSchema = null;\n    _this.schema = null;\n\n    _this.setEditorRef = function (ref) {\n      _this.editor = ref;\n    };\n\n    _this.value = function () {\n      // return Markdown.serialize(this.props.editorValue);\n      return _this.props.editorValue;\n    };\n\n    _this.handleChange = function (_ref) {\n      var value = _ref.value;\n\n      if (_this.props.onChange && !_this.props.readOnly) {\n        _this.props.onChange(value);\n      }\n    };\n\n    _this.handleDrop = function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regenerator2.default.mark(function _callee(ev) {\n        var files, i, _file;\n\n        return _regenerator2.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!_this.props.readOnly) {\n                  _context.next = 2;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 2:\n                if (_this.editor.props.uploadImage) {\n                  _context.next = 4;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 4:\n                if (!ev.isDefaultPrevented()) {\n                  _context.next = 6;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 6:\n                // otherwise we'll handle this\n                ev.preventDefault();\n                ev.stopPropagation();\n                files = (0, _getDataTransferFiles2.default)(ev);\n                i = 0;\n\n              case 10:\n                if (!(i < files.length)) {\n                  _context.next = 18;\n                  break;\n                }\n\n                _file = files[i];\n\n                if (!_file.type.startsWith(\"image/\")) {\n                  _context.next = 15;\n                  break;\n                }\n\n                _context.next = 15;\n                return _this.insertImageFile(_file);\n\n              case 15:\n                i++;\n                _context.next = 10;\n                break;\n\n              case 18:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, _this2);\n      }));\n\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    _this.insertImageFile = function (file) {\n      _this.editor.insertImageFile(file);\n    };\n\n    _this.cancelEvent = function (ev) {\n      ev.preventDefault();\n    };\n\n    _this.handleKeyDown = function (ev, editor) {\n      var next = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function () {};\n      if (_this.props.readOnly) return next();\n\n      switch (ev.key) {\n        case \"s\":\n          if ((0, _isModKey2.default)(ev)) return _this.onSave(ev);\n          break;\n\n        case \"Enter\":\n          if ((0, _isModKey2.default)(ev)) return _this.onSaveAndExit(ev);\n          break;\n\n        case \"Escape\":\n          if ((0, _isModKey2.default)(ev)) return _this.onCancel(ev);\n          break;\n\n        default:\n      }\n\n      return next();\n    };\n\n    _this.focusAtStart = function () {\n      var editor = _this.editor;\n      editor.moveToStartOfDocument().focus();\n    };\n\n    _this.focusAtEnd = function () {\n      var editor = _this.editor;\n      editor.moveToEndOfDocument().focus();\n    };\n\n    _this.getSchema = function () {\n      if (_this.prevSchema !== _this.props.schema) {\n        _this.schema = _extends({}, _schema2.default, _this.props.schema || {});\n        _this.prevSchema = _this.props.schema;\n      }\n\n      return _this.schema;\n    };\n\n    _this.render = function () {\n      var _this$props = _this.props,\n          readOnly = _this$props.readOnly,\n          pretitle = _this$props.pretitle,\n          placeholder = _this$props.placeholder,\n          onSave = _this$props.onSave,\n          onChange = _this$props.onChange,\n          onCancel = _this$props.onCancel,\n          uploadImage = _this$props.uploadImage,\n          onSearchLink = _this$props.onSearchLink,\n          onClickLink = _this$props.onClickLink,\n          onImageUploadStart = _this$props.onImageUploadStart,\n          onImageUploadStop = _this$props.onImageUploadStop,\n          onShowToast = _this$props.onShowToast,\n          className = _this$props.className,\n          style = _this$props.style,\n          dark = _this$props.dark,\n          defaultValue = _this$props.defaultValue,\n          autoFocus = _this$props.autoFocus,\n          plugins = _this$props.plugins,\n          rest = _objectWithoutProperties(_this$props, [\"readOnly\", \"pretitle\", \"placeholder\", \"onSave\", \"onChange\", \"onCancel\", \"uploadImage\", \"onSearchLink\", \"onClickLink\", \"onImageUploadStart\", \"onImageUploadStop\", \"onShowToast\", \"className\", \"style\", \"dark\", \"defaultValue\", \"autoFocus\", \"plugins\"]);\n\n      var theme = _this.props.theme || (dark ? _theme.dark : _theme.light);\n      var editorValue = _this.props.editorValue;\n\n      if (typeof _this.props.editorValue === \"string\") {\n        editorValue = _serializer2.default.deserialize(_this.props.editorValue);\n      }\n\n      return React.createElement(_Flex2.default, {\n        style: style,\n        className: className,\n        onDrop: _this.handleDrop,\n        onDragOver: _this.cancelEvent,\n        onDragEnter: _this.cancelEvent,\n        align: \"flex-start\",\n        justify: \"center\",\n        column: true,\n        auto: true\n      }, React.createElement(_styledComponents.ThemeProvider, {\n        theme: theme\n      }, React.createElement(StyledEditor, _extends({\n        ref: _this.setEditorRef,\n        plugins: _this.plugins,\n        value: editorValue,\n        commands: _commands2.default,\n        queries: _queries2.default,\n        placeholder: placeholder,\n        schema: _this.getSchema(),\n        onKeyDown: _this.handleKeyDown,\n        onChange: _this.handleChange,\n        onSave: onSave,\n        onSearchLink: onSearchLink,\n        onClickLink: onClickLink,\n        onImageUploadStart: onImageUploadStart,\n        onImageUploadStop: onImageUploadStop,\n        onShowToast: onShowToast,\n        readOnly: readOnly,\n        spellCheck: !readOnly,\n        uploadImage: uploadImage,\n        pretitle: pretitle,\n        options: defaultOptions\n      }, rest))));\n    };\n\n    var builtInPlugins = (0, _plugins2.default)({\n      placeholder: props.placeholder,\n      getLinkComponent: props.getLinkComponent\n    }); // in Slate plugins earlier in the stack can opt not to continue\n    // to later ones. By adding overrides first we give more control\n\n    _this.plugins = [].concat(_toConsumableArray(props.plugins), _toConsumableArray(builtInPlugins));\n    return _this;\n  }\n\n  _createClass(RichMarkdownEditor, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.scrollToAnchor();\n      if (this.props.readOnly) return;\n\n      if (typeof window !== \"undefined\") {\n        window.addEventListener(\"keydown\", this.handleKeyDown);\n      }\n\n      if (this.props.autoFocus) {\n        this.focusAtEnd();\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (prevProps.readOnly && !this.props.readOnly && this.props.autoFocus) {\n        this.focusAtEnd();\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      if (typeof window !== \"undefined\") {\n        window.removeEventListener(\"keydown\", this.handleKeyDown);\n      }\n    }\n  }, {\n    key: \"scrollToAnchor\",\n    value: function scrollToAnchor() {\n      var hash = window.location.hash;\n      if (!hash) return;\n\n      try {\n        var element = document.querySelector(hash);\n        if (element) element.scrollIntoView({\n          behavior: \"smooth\"\n        });\n      } catch (err) {\n        // querySelector will throw an error if the hash begins with a number\n        // or contains a period. This is protected against now by safeSlugify\n        // however previous links may be in the wild.\n        console.warn(\"Attempted to scroll to invalid hash\", err);\n      }\n    }\n  }, {\n    key: \"onSave\",\n    value: function onSave(ev) {\n      var onSave = this.props.onSave;\n\n      if (onSave) {\n        ev.preventDefault();\n        ev.stopPropagation();\n        onSave({\n          done: false\n        });\n      }\n    }\n  }, {\n    key: \"onSaveAndExit\",\n    value: function onSaveAndExit(ev) {\n      var onSave = this.props.onSave;\n\n      if (onSave) {\n        ev.preventDefault();\n        ev.stopPropagation();\n        onSave({\n          done: true\n        });\n      }\n    }\n  }, {\n    key: \"onCancel\",\n    value: function onCancel(ev) {\n      var onCancel = this.props.onCancel;\n\n      if (onCancel) {\n        ev.preventDefault();\n        ev.stopPropagation();\n        onCancel();\n      }\n    }\n  }]);\n\n  return RichMarkdownEditor;\n}(React.PureComponent), _class.defaultProps = {\n  editorValue: \"\",\n  placeholder: \"Write something nice…\",\n  onImageUploadStart: function onImageUploadStart() {},\n  onImageUploadStop: function onImageUploadStop() {},\n  plugins: [],\n  tooltip: \"span\"\n}, _temp);\nvar StyledEditor = (0, _styledComponents2.default)(_slateReact.Editor).withConfig({\n  displayName: \"src__StyledEditor\",\n  componentId: \"sc-1d306fq-0\"\n})([\"color:\", \";background:\", \";font-family:\", \";font-weight:\", \";font-size:1em;line-height:1.7em;width:100%;h1,h2,h3,h4,h5,h6{font-weight:500;}ul,ol{margin:0 0.1em;padding-left:1em;ul,ol{margin:0.1em;}}p{position:relative;margin:0;}a{color:\", \";}a:hover{text-decoration:\", \";}li p{display:inline;margin:0;}.todoList{list-style:none;padding-left:0;.todoList{padding-left:1em;}}.todo{span:last-child:focus{outline:none;}}blockquote{border-left:3px solid \", \";margin:0;padding-left:10px;font-style:italic;}b,strong{font-weight:600;}\"], function (props) {\n  return props.theme.text;\n}, function (props) {\n  return props.theme.background;\n}, function (props) {\n  return props.theme.fontFamily;\n}, function (props) {\n  return props.theme.fontWeight;\n}, function (props) {\n  return props.theme.link;\n}, function (props) {\n  return props.readOnly ? \"underline\" : \"none\";\n}, function (props) {\n  return props.theme.quote;\n});\nexports.default = RichMarkdownEditor;","map":null,"metadata":{},"sourceType":"script"}