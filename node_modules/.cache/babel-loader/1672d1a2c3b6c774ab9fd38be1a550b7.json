{"ast":null,"code":"import { BlockType } from '@blink-mind/core';\nimport { createElement } from 'react';\nimport { BaseWidget, descEditorRefKey } from '@blink-mind/renderer-react';\nimport RichMarkDownEditor from 'awehook-rich-markdown-editor';\nimport debug from 'debug';\nimport styled from 'styled-components';\nimport MarkdownSerializer from 'slate-md-serializer';\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\n\n/* global Reflect, Promise */\n\nvar extendStatics = function (d, b) {\n  extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n  };\n\n  return extendStatics(d, b);\n};\n\nfunction __extends(d, b) {\n  extendStatics(d, b);\n\n  function __() {\n    this.constructor = d;\n  }\n\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nvar __assign = function () {\n  __assign = Object.assign || function __assign(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nfunction __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) {\n    Object.defineProperty(cooked, \"raw\", {\n      value: raw\n    });\n  } else {\n    cooked.raw = raw;\n  }\n\n  return cooked;\n}\n\nvar log = debug('node:topic-content-editor');\nvar NodeContent = styled.div(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"\\n  \", \";\\n\"], [\"\\n  \", \";\\n\"])), function (props) {\n  return !props.readOnly && \"\\n    // padding: 75px\\n    // min-width: 150px\\n    // min-height: 150px\\n  \";\n});\n\nvar RichTextEditor =\n/** @class */\nfunction (_super) {\n  __extends(RichTextEditor, _super);\n\n  function RichTextEditor(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.onMouseDown = function (e) {\n      e.stopPropagation();\n    };\n\n    _this.onMouseMove = function (e) {\n      e.stopPropagation();\n    };\n\n    _this.rootRef = function (saveRef) {\n      return function (ref) {\n        saveRef(ref);\n        _this.root = ref;\n      };\n    };\n\n    _this._handleClick = function (event) {\n      var wasOutside = !_this.root.contains(event.target);\n      wasOutside && _this.onClickOutSide(event);\n    };\n\n    _this.initState();\n\n    return _this;\n  }\n\n  RichTextEditor.prototype.initState = function () {\n    this.state = {\n      content: this.getContent()\n    };\n  };\n\n  RichTextEditor.prototype.getContent = function () {\n    var block = this.getCustomizeProps().block;\n    return block.data;\n  };\n\n  RichTextEditor.prototype.onChange = function (value) {\n    this.setState({\n      content: value\n    });\n  };\n\n  RichTextEditor.prototype.getCustomizeProps = function () {\n    return null;\n  };\n\n  RichTextEditor.prototype.componentDidMount = function () {\n    document.addEventListener('click', this._handleClick);\n  };\n\n  RichTextEditor.prototype.componentWillUnmount = function () {\n    document.removeEventListener('click', this._handleClick);\n  };\n\n  RichTextEditor.prototype.onClickOutSide = function (e) {};\n\n  RichTextEditor.prototype.render = function () {\n    var _a = this.props,\n        topicKey = _a.topicKey,\n        saveRef = _a.saveRef;\n\n    var _b = this.getCustomizeProps(),\n        readOnly = _b.readOnly,\n        getRefKeyFunc = _b.getRefKeyFunc,\n        placeholder = _b.placeholder;\n\n    log('readOnly:', readOnly);\n    var content = readOnly ? this.getContent() : this.state.content;\n    if (content == null) return null;\n    var key = getRefKeyFunc(topicKey);\n\n    var _c = this,\n        onMouseDown = _c.onMouseDown,\n        onMouseMove = _c.onMouseMove;\n\n    var richEditorProps = {\n      editorValue: content,\n      readOnly: readOnly,\n      onChange: this.onChange.bind(this),\n      placeholder: placeholder\n    };\n    var nodeContentProps = {\n      key: key,\n      ref: this.rootRef(saveRef(key)),\n      readOnly: readOnly,\n      onMouseDown: onMouseDown,\n      onMouseMove: onMouseMove\n    };\n    return createElement(NodeContent, __assign({}, nodeContentProps), createElement(RichMarkDownEditor, __assign({}, richEditorProps)));\n  };\n\n  return RichTextEditor;\n}(BaseWidget);\n\nvar templateObject_1;\n\nvar TopicDescEditor =\n/** @class */\nfunction (_super) {\n  __extends(TopicDescEditor, _super);\n\n  function TopicDescEditor() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  TopicDescEditor.prototype.initState = function () {\n    _super.prototype.initState.call(this);\n\n    var _a = this.props,\n        controller = _a.controller,\n        topicKey = _a.topicKey;\n    var key = \"topic-desc-data-\" + topicKey;\n    var value = this.state.content;\n    controller.run('setTempValue', {\n      key: key,\n      value: value\n    });\n  };\n\n  TopicDescEditor.prototype.getCustomizeProps = function () {\n    var _a = this.props,\n        model = _a.model,\n        topicKey = _a.topicKey;\n    var block = model.getTopic(topicKey).getBlock(BlockType.DESC).block;\n    var readOnly = model.editingDescKey !== topicKey; //TODO\n\n    var getRefKeyFunc = descEditorRefKey;\n    return {\n      block: block,\n      readOnly: readOnly,\n      getRefKeyFunc: getRefKeyFunc,\n      placeholder: 'write topic notes here'\n    };\n  };\n\n  TopicDescEditor.prototype.onChange = function (value) {\n    var _a = this.props,\n        controller = _a.controller,\n        topicKey = _a.topicKey;\n    var key = \"topic-desc-data-\" + topicKey;\n    controller.run('setTempValue', {\n      key: key,\n      value: value\n    });\n    this.setState({\n      content: value\n    });\n  };\n\n  return TopicDescEditor;\n}(RichTextEditor);\n\nvar markdownSerializer = new MarkdownSerializer();\n\nfunction RichTextEditorPlugin() {\n  return {\n    renderTopicDescEditor: function (props) {\n      return createElement(TopicDescEditor, __assign({}, props));\n    },\n    isBlockEmpty: function (props, next) {\n      var block = props.block,\n          controller = props.controller;\n\n      if (block.type === BlockType.CONTENT || block.type === BlockType.DESC) {\n        return block.data == null || controller.run('serializeBlockData', props) === '';\n      }\n\n      return next();\n    },\n    serializeBlockData: function (props, next) {\n      var block = props.block;\n\n      if (block.type === BlockType.DESC) {\n        return typeof block.data === 'string' ? block.data : markdownSerializer.serialize(block.data);\n      }\n\n      return next();\n    }\n  };\n}\n\nexport default RichTextEditorPlugin;","map":null,"metadata":{},"sourceType":"module"}